# 概述

几种数据预处理的技术，包括：**数据清理，数据集成，数据规约，数据变换**

- 数据规约：通过如聚集、删除冗余特征或聚类来降低数据的规模
- 数据变换：将数据由多个数据源合并成一个一致的数据存储，如数据仓库。用来把数据压缩到较小的区间，如 0-1，可以提高涉及距离度量的挖掘算法的准确率和效率

不正确数据的原因

- 数据收集工具可能错误
- 故意提交了错误的资料
- 传输错误
- 命名习惯或者数据编码的不一致性

数据的不完整

- 感兴趣的属性并不能总是可获得
- 被认为是不重要的没记录
- 误解或者设备故障

不一致的数据需要被删除

数据的时效性、数据的可信性和可解释性都影响数据的质量

## 数据预处理的步骤

- 数据清理
  - 通过填写缺失的数据，平滑噪声数据，识别需要去除的离群点，以及**解决不一致性**
- 数据集成
  - 聚合多种数据库，数据立方，以及文件
  - 所以可能导致了不一致性和冗余
- 数据规约
  - 维度规约 (主成分分析) 和数量规约 (采样，聚类，对数线性模型)
- 数据转换
  - 数据标准化，缩小到一个更小的范围
  - 离散化和概念层次生成也很有效 (概述一个特征)

# 数据清理

## 缺失值

1. **忽略元组 (数据对象)，删除数据** (保证数据的准确性，但是容易缺失大量其他特征，对小规模数据不友好)
2. **人工**填写缺失值
3. 使用一个**全局常量**来填写缺失值
4. 使用一个属性的**中心性测量**来填写缺失值
5. 使用给定元组的**类别的中心性**来填充
6. **最可能的值**来填写 (回归，贝叶斯，决策树推理)

在某些情形，一个缺失的值并非意味着数据的错误

## 噪声数据

### 分箱

分箱方法通过**参考数据值的“邻居”**（即该值周围的数据）来平滑排好序的数据

- **等频分箱**。例如，价格属性先被排序，然后被分割到箱子的大小为 3 的等频箱子中
- **箱子均值平滑**。箱子中的每个值被箱子的均值替代
- **箱子中值平滑**。每个箱子值被箱子中值取代
- **箱子边界平滑**。箱子值被最靠近的边界值（最大值或最小值）取代

箱子的宽度也大，平滑效果也越显著

### 回归

将数据值通过一个函数来表达，线性回归是寻找两个属性（或变量）的最好的直线来通过一个属性预测另外一个

### 离群点分析

通过聚类的方法可以检测离群点，值落在簇之外的被认为是离群点

# 数据集成

合并多个数据库中的数据

## 实体识别问题

将真实世界中的实体等价地匹配到多个数据源中

需要注意数据的结构，必须保证源系统中的任何属性的功能性依赖关系以及参考限制与目标系统匹配

## 冗余和相关分析

(1) 它能从其他的属性或属性集合推导得到

(2) 属性的不一致或者维度命名也会导致相应数据集中的冗余

- **标称数据**，可以使用**卡方检验**
- **数值型数据**，使用**相关系数和协方差**

### 标称数据卡方检验

卡方值公式：

$$
\chi^2 = \sum_{i=1}^c \sum_{j=1}^r \frac{(o_{ij} - e_{ij})^2}{e_{ij}}
$$

期望值的计算公式为：

$$
e_{ij} = \frac{\text{count}(A = a_i) \times \text{count}(B = b_j)}{n},
$$

其中：
- $n$ 表示样本总数。
- oij 表示观察到的 (Ai, Bj) 联合事件的频率（实际次数）
- eij 表示 (Ai,Bj) 事件的期望频率

公式计算全部 $r*c$ 个单元的值

卡方统计检验假定属性 A 和属性 B 是互相独立的,即这两个属性之间没有关联

**自由度**是 $(r-1)*(c-1)$ ：基于这个查表的依据

如果假设被拒绝，则 A 和 B 统计相关

### 数值型数据的相关系数

---

#### 皮尔逊相关系数公式

对于数值型属性，可以通过计算**相关系数（皮尔逊相关系数）** 来估计两个属性 $A$ 和 $B$ 之间的相关性：

$$
r_{A, B} = \frac{\sum_{i=1}^n (a_i - \overline{A})(b_i - \overline{B})}{n \sigma_A \sigma_B} = \frac{\sum_{i=1}^n a_i b_i - n \overline{A} \overline{B}}{n \sigma_A \sigma_B},
$$

其中：

- $n$ 是元组的个数，
- $a_i$ 和 $b_i$ 是元组 $i$ 的属性 $A$ 和属性 $B$ 的值，
- $\overline{A}$ 和 $\overline{B}$ 表示属性 $A$ 和属性 $B$ 的**均值**，
- $\sigma_A$ 和 $\sigma_B$ 是属性 $A$ 和属性 $B$ 的**标准差**

#### 相关系数 $r_{AB}$ 范围与解释

- 相关系数 $r_{AB}$ 的值在 **$-1$ 到 $+1$** 之间。
- 如果 $r_{AB} > 0$，则称 $A$ 和 $B$ **正相关**。
  表示 $A$ 的值随着 $B$ 的值的增大而增大。值越大，相关性越强。

因此，一个很大的值意味着 $A$（或 $B$）需要被作为冗余删除

### 数值型数据的协方差

---

#### 相关性与协方差

在概率理论和统计学中，**相关性** 和 **协方差** 是评价两个属性是否一起发生变化的两种相似的测量。

---

考虑两个**数值型属性** $A$ 和 $B$，$n$ 个观察 $\{(a_1, b_1), \dots, (a_n, b_n)\}$。

属性 $A$ 和属性 $B$ 的均值（即期望值）为：

$$
E(A) = \overline{A} = \frac{\sum_{i=1}^n a_i}{n}
$$

和

$$
E(B) = \overline{B} = \frac{\sum_{i=1}^n b_i}{n}.
$$

#### 协方差与相关系数公式

属性 $A$ 和 $B$ 的协方差：

$$
\text{Cov}(A, B) = E\left((A - \overline{A})(B - \overline{B})\right) = \frac{\sum_{i=1}^n (a_i - \overline{A})(b_i - \overline{B})}{n}.
$$

利用协方差计算相关系数 $r_{A, B}$：

$$
r_{A, B} = \frac{\text{Cov}(A, B)}{\sigma_A \sigma_B},
$$

其中分母是属性 $A$ 和 $B$ 的标准差。

可以进一步表示为：
$$
\text{Cov}(A, B) = E(A \cdot B) - \overline{A} \cdot \overline{B}.
$$

#### 协方差的性质

对于一起发生变化的属性 $A$ 和 $B$：

- 如果 $A$ 大于 $\overline{A}$ 时，$B$ 也可能大于 $\overline{B}$，则 $A$ 和 $B$ 之间的**协方差为正**
- 如果一个属性的值在均值以下时，另一个倾向于在均值以上，则**协方差为负**

#### 协方差与独立性

如果 $A$ 和 $B$ 相互独立（没有关联），则：

$$
E(AB) = E(A)E(B),
$$

此时协方差为 0。

---

**但反过来并不成立**：

- 即便某些随机变量对的协方差值为 0，也并不表示它们独立
- 只有在某些额外的假设（如数据满足多元正态分布）的情况下，协方差为 0 才能证明独立性

### 元组复制

除了检测属性间的冗余，元组级别的冗余也需要被检测。

- 去规范化表的使用
  - 一般是为了避免连接提高性能
  - 是另一种数据冗余的来源

在不同的复制之间常常产生不一致性。因为不
精确的数据输入或者更新了一部分而非全部的
数据

### 数据值冲突检测与处理

- 数据值冲突
  - 比如，体重属性在一个系统中可能以公制单位存放，而在另一个中以英制单位存放
- 属性的**抽象级别**也可能不同
  - 在一个抽象级别更低的系统中，同一个属性的级别比另一个系统中同样的值更低

# 数据规约

在规约后的数据集上挖掘将更有效，仍然产生相同的分析结果

## 数据规约策略概览

数据规约策略包含
- 维规约
- 数量规约

### 维规约

是减少考虑的随机变量或属性的个数

维规约方法包括
- 小波转换
- 主成分分析
- 属性子集选择

即将原有数据转换或者投影到一个更小的空间

是检测和删除不相关的、弱相关的、冗余的属性和维度的减少维度的方法

好处：

- 进行数据压缩，减少数据存储所需空间以及计算所需时间
- 消除数据间的冗余，以简化数据，提高计算效率
- 去除噪声，提高模型性能
- 改善数据的可理解性，提高学习算法的精度
- 将数据维度减少到 2 维或者 3 维，​进行可视化

#### 维规约方式

- 属性子集选择
  - 选择有效的特征子集，即去掉不相关或冗余的特征
  - 特征选择后留下的特征值的数值在选择前后没有变化
  - 是原来特征的一个**子集**
- 特征提取
  - 指改变原有的特征空间，并将其映射到一个新的特征空间
  - 特征抽取后的新特征是原来特征的一个**映射**

### 数量规约

数量规约是将原有数据以**可选的、更小的数据**替换

- 参数
  - 一个模型来评估数据，常常只有数据参数被存储
- 非参数
  - 存放以直方图、聚类、抽样以及数据立方的形式表示数据

## 数据压缩

应用转换来得到一个**原有数据的规约或压缩**的表达

- 如果原有数据能从**压缩**数据中被重构而**没有任何信息损失**，则数据删减是**无损的**
- 如果只能重构原有数据的近似集，则数据删减是**有损的**

---
PS：维规约和数量规约也能被看成是数据压缩的形式

**花在数据删减上的时间复杂度**不应当超过或等于在归约后的数据上挖掘所**节省的时间**

### 小波转换

离散小波转换 (DWT)

对一个数据向量 $X$ , 使用**小波系数**，转换成一个不同的数值向量 $X’$

- **有效性**在于小波转换的数据**能够被截短**
- 只存放了小波系数最强的一小部分数据
  - 阈值更大的小波系数保留，其他的系数被设置为 0。
  - 得到的数据表达因此非常稀疏，操作就可以利用数据的稀疏性，在小波空间**计算将非常快**

---

给定一系列系数，原有数据的近似能应用逆 DWT 被重构

小波变换对于**稀疏或偏斜的数据**有很好的效果，以及**序数属性的数据上**

### 主成分分析

主成分分析 (PCA) 寻找 k 个**最能代表数据**的 n 维正交向量，这些向量能最好的表达数据投影到更小的空间得到维归约

PCA 目标
- 是找到数据中最主要的元素和结构
- 去除噪音和冗余
- 将原有的复杂数据降维
- 揭露出隐藏在复杂数据背后的简单结构

#### PCA 的基本步骤

1. 将输入数据标准化，每个属性落在相同的值区间。确保属性在更大范围的不会占有更大权重
2. 计算 k 个标准正交向量，可以通过 SVD 奇异值分解
3. 主成分按重要性或者长度递减的次序存放，即，排序的坐标轴中，第一个轴表示数据的最大方差，第二个表示次高的方差，以此类推
4. 因为主成分按重要性的降序排列，数据规约可以通过去除次要成分来减少
